<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCU ChronoLog</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lexend&display=swap" rel="stylesheet">
    <style>
        /* --- Base Styles & Smooth Scroll --- */
        /* Enables smooth scrolling when navigating to section IDs */
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Lexend', sans-serif; /* Apply Lexend font */
            background-color: #0d0d0d; /* Very dark background */
            color: white; /* Default text color */
            margin: 0;
            padding: 0;
            overflow-x: hidden; /* Prevent horizontal scroll caused by animations */
        }

        /* --- Animations & Effects --- */
        /* Multiverse text gradient animation */
        .multiverse-text {
            background: linear-gradient(to right, white, red, yellow, green, blue);
            background-size: 500% auto;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: colorSweepLetter 15s ease-in-out infinite;
            display: inline-block;
        }
        @keyframes colorSweepLetter {
            0% { background-position: 500% 0; }
            100% { background-position: -500% 0; }
        }

        /* Worm line animation below "ChronoLog" in About section */
        .worm-line {
            position: absolute;
            bottom: -6px;
            left: 0;
            width: 100%;
            height: 14px;
            overflow: hidden;
            mask-image: linear-gradient(to right, transparent, black 20%, black 80%, transparent);
            -webkit-mask-image: linear-gradient(to right, transparent, black 20%, black 80%, transparent);
        }
        .worm-container {
            position: absolute;
            width: 200%;
            height: 100%;
            display: flex;
            animation: wormScroll 8s ease-in-out infinite;
        }
        @keyframes wormScroll {
            0%, 100% { transform: translateX(0%); }
            50% { transform: translateX(-50%); }
        }
        .wiggle path {
            animation: wigglePath 2s ease-in-out infinite;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        @keyframes wigglePath {
            0%, 100% { d: path("M0,6 Q10,0 20,6 T40,6 T60,6 T80,6 T100,6 T120,6 T140,6 T160,6 T180,6 T200,6"); }
            50% { d: path("M0,6 Q10,12 20,6 T40,6 T60,6 T80,6 T100,6 T120,6 T140,6 T160,6 T180,6 T200,6"); }
        }

        /* --- Start Tracking Button Styles (Particle effect removed) --- */
        #startTrackingBtn {
            /* Removed position: relative and overflow: hidden */
            padding: 0.75rem 1.5rem; /* px-6 py-3 */
            background-color: #dc2626; /* Tailwind red-600 */
            color: white;
            font-family: 'Lexend', sans-serif; /* Ensure Lexend font */
            font-size: 18px;
            font-weight: 700;
            letter-spacing: 0.05em;
            border-radius: 9999px; /* Tailwind rounded-full */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
            z-index: 1;
            border: none; /* Ensure no default button border */
            cursor: pointer; /* Indicate clickable */
            display: flex; /* Use flexbox for text and arrow */
            align-items: center;
            gap: 8px; /* Space between text and arrow */
        }

        #startTrackingBtn:hover {
            transform: scale(1.05);
        }

        /* Removed ::before pseudo-element style */
        /* Removed @keyframes pulseParticles */

        /* Style for the text span inside the button */
        #startTrackingBtn span {
            /* Position relative is no longer strictly needed for z-index over pseudo-element */
            color: #ffffff;
            transition: color 0.3s ease;
        }

        /* Style for the arrow span inside the button */
        #startTrackingBtn .arrow {
            /* Position relative is no longer strictly needed for z-index over pseudo-element */
            display: inline-block;
            transform: translateY(0);
            transition: transform 0.4s ease; /* Transition for downward movement on hover */
            font-size: 1.2em;
            line-height: 1;
        }

        /* Hover effect for the arrow */
        #startTrackingBtn:hover .arrow {
            transform: translateY(3px); /* Move arrow down slightly on hover */
        }

        /* Active state for the button */
        #startTrackingBtn:active {
            transform: scale(0.95);
        }


        /* --- Layout Sections --- */
        #landing {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 40px 20px;
            position: relative;
        }

        /* Removed the explicit font-weight: 400 rule */

         #landing-observer-target {
             position: absolute;
             bottom: 0;
             left: 0;
             width: 100%;
             height: 1px;
             pointer-events: none;
             z-index: -1;
         }

        /* Tracker section - Made visible by default */
        #tracker {
            display: flex;
            flex-direction: column;
            padding: 20px;
            gap: 20px;
            align-items: stretch;
            max-width: 1200px;
            margin: 40px auto 0 auto;
            width: 100%;
            box-sizing: border-box;
        }
         #tracker.visible {
             display: flex;
             opacity: 1;
        }

        /* About section styles - initially hidden */
        #about {
            display: none;
            padding: 40px 20px;
            text-align: center;
            margin-top: 40px;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
         #about.visible {
             display: block;
             opacity: 1;
         }


        /* Container for Controls + Progress */
        .main-content {
             display: flex;
             flex-direction: column;
             gap: 20px;
             width: 100%;
        }

        /* --- Controls Area (Search, Filters, Sort) --- */
        .controls {
             background: #121212;
             border-radius: 8px;
           }
        .search-bar { flex-grow: 1; min-width: 200px; }
        .search-bar input {
             width: 100%;
             padding: 10px 15px;
             border-radius: 5px;
             background: #222;
             color: white;
             border: 1px solid #555;
             font-size: 1em;
             font-family: 'Lexend', sans-serif; /* Apply Lexend font */
        }
        .search-bar input::placeholder { color: #888; }

        /* --- Added: Focus state for input --- */
        .search-bar input:focus {
            outline: none;
            border-color: red;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.5);
        }


        /* Filter button styles */
        .filter-buttons { display: flex; flex-wrap: wrap; gap: 8px; }
        .filter-buttons button {
            margin: 0;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            background: #333;
            color: white;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
            font-size: 0.9em;
            font-family: 'Lexend', sans-serif; /* Apply Lexend font */
        }
        .filter-buttons button:hover { background: #444; }
        .filter-buttons button.active { background: red; }
        .filter-buttons button.active:hover { background: darkred; }

        /* --- Added: Active and Focus states for buttons --- */
         .filter-buttons button:active { transform: scale(0.98); }
         .filter-buttons button:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.5);
         }


        /* Sort dropdown styles */
        .sort-select { display: flex; align-items: center; gap: 5px; }
        .sort-select label {
            font-size: 0.9em;
            color: #ccc;
            font-family: 'Lexend', sans-serif; /* Apply Lexend font */
        }
        .sort-select select {
            padding: 8px 10px;
            border-radius: 5px;
            background: #222;
            color: white;
            border: 1px solid #555;
            cursor: pointer;
            font-size: 0.9em;
            font-family: 'Lexend', sans-serif; /* Apply Lexend font */
        }
         /* --- Added: Focus state for select --- */
         .sort-select select:focus {
             outline: none;
             border-color: red;
             box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.5);
         }


        /* --- Progress Area --- */
        .progress-container-group {
             display: flex;
             flex-direction: column;
             gap: 10px;
         }

        .progress-area {
            display: flex;
            align-items: center;
            gap: 15px;
            background: #121212;
            padding: 15px;
            border-radius: 8px;
            width: 100%;
            box-sizing: border-box;
        }
         .progress-area .progress-label {
             font-size: 0.8em;
             color: #ccc;
             min-width: 60px;
             flex-shrink: 0;
             font-family: 'Lexend', sans-serif; /* Apply Lexend font */
         }

        .progress-container {
            flex-grow: 1;
            height: 10px;
            background: #333;
            border-radius: 5px;
            overflow: hidden;
        }
        .progress {
            height: 100%;
            background: linear-gradient(to right, #ef4444, #b91c1c);
            width: 0;
            border-radius: 5px;
            box-shadow: 0 0 6px rgba(239, 68, 68, 0.6);
            transition: width 0.5s ease-out;
        }
        .progress-area .progress-count {
            font-size: 0.9em;
            color: #ccc;
            white-space: nowrap;
            flex-shrink: 0;
            min-width: 80px;
            text-align: right;
            font-family: 'Lexend', sans-serif; /* Apply Lexend font */
        }

        /* --- Movie List & Custom Scrollbar --- */
        .movie-list-container {
            position: relative;
            background: #1a1a1a;
            border-radius: 8px;
            padding: 15px;
            overflow-y: auto;
            max-height: 60vh;
            width: 100%;
            box-sizing: border-box;
            flex-shrink: 0;
            min-height: 150px;

            /* --- Custom Scrollbar (Firefox) --- */
            scrollbar-width: thin;
            scrollbar-color: #16a34a #222;
        }
        /* --- Custom Scrollbar (WebKit - Chrome, Safari, Edge) --- */
        .movie-list-container::-webkit-scrollbar { width: 8px; }
        .movie-list-container::-webkit-scrollbar-track { background: #222; border-radius: 4px; }
        .movie-list-container::-webkit-scrollbar-thumb { background-color: #16a34a; border-radius: 4px; }
        .movie-list-container::-webkit-scrollbar-thumb:hover { background-color: #22c55e; }

        .movie-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding-right: 5px;
            transition: opacity 0.3s ease-in-out;
        }

        /* Individual movie item styling */
        .movie-item {
            background: #1f1f1f;
            padding: 12px 15px;
            border-radius: 6px;
            border-left: 4px solid red;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 10px;
            transition: background-color 0.2s ease;
            opacity: 1;
            transform: translateY(0);
            transition: opacity 0.3s ease, transform 0.3s ease, background-color 0.2s ease;
        }
        .movie-item:hover { background-color: #2a2a2a; }

        /* Movie title, date, type container */
        .movie-item-info {
            flex-grow: 1;
            min-width: 150px;
            flex-shrink: 1;
        }
        .movie-item h3 {
            margin: 0 0 2px 0;
            font-size: 1em;
            line-height: 1.3;
            font-family: 'Lexend', sans-serif; /* Apply Lexend font */
        }
        .movie-item p {
            margin: 0;
            color: #aaa;
            font-size: 0.8em;
            line-height: 1.4;
            font-family: 'Lexend', sans-serif; /* Apply Lexend font */
        }

        /* --- Added: Type display enhancement --- */
        .movie-item p.type {
            font-style: italic;
            font-size: 0.75em;
            position: relative;
            padding-left: 15px;
            color: #ccc;
            font-family: 'Lexend', sans-serif; /* Apply Lexend font */
        }
        .movie-item p.type::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: #16a34a;
        }


        /* --- Checkbox Styling --- */
        .checkbox {
            flex-shrink: 0;
            padding: 5px;
            margin-left: auto;
        }
        .checkbox input[type="checkbox"] {
            appearance: none;
            position: relative;
            width: 24px;
            height: 24px;
            border: 2px solid white;
            border-radius: 4px;
            background: none;
            cursor: pointer;
            vertical-align: middle;
            transition: background-color 0.2s ease, border-color 0.2s ease, transform 0.1s ease;
            display: inline-block;
        }
        /* Checked state */
        .checkbox input[type="checkbox"]:checked {
            background: #16a34a;
            border-color: #15803d;
        }
        /* Hover states */
        .checkbox input[type="checkbox"]:hover { border-color: #ccc; }
        .checkbox input[type="checkbox"]:checked:hover {
             background-color: #22c55e;
             border-color: #16a34a;
        }
        /* --- Added: Active and Focus states for checkbox --- */
         .checkbox input[type="checkbox"]:active { transform: scale(0.95); }
         .checkbox input[type="checkbox"]:focus {
             outline: none;
             box-shadow: 0 0 0 3px rgba(22, 163, 74, 0.5);
         }

        /* Custom checkmark using ::after pseudo-element */
        .checkbox input[type="checkbox"]:checked::after {
            content: '';
            display: block;
            position: absolute;
            top: 3px; left: 8px;
            width: 6px; height: 12px;
            border: solid white;
            border-width: 0 3px 3px 0;
            transform: rotate(45deg);
        }

        /* Highlight search matches */
        .highlight {
             background-color: yellow;
             color: black;
             font-weight: bold;
             border-radius: 2px;
             padding: 0 2px;
           }

        /* --- Added: Loading State & Empty State --- */
         .loading-indicator, .empty-state {
             position: absolute;
             top: 0;
             left: 0;
             width: 100%;
             height: 100%;
             display: flex;
             flex-direction: column;
             justify-content: center;
             align-items: center;
             background-color: rgba(26, 26, 26, 0.9);
             color: #ccc;
             font-size: 1.1em;
             z-index: 10;
             transition: opacity 0.3s ease;
             pointer-events: none;
            min-height: inherit;
            box-sizing: border-box;
             font-family: 'Lexend', sans-serif; /* Apply Lexend font */
         }

        .loading-indicator .spinner {
             border: 4px solid rgba(255, 255, 255, 0.3);
             border-radius: 50%;
             border-top: 4px solid white;
             width: 40px;
             height: 40px;
             animation: spin 1s linear infinite;
             margin-bottom: 10px;
         }

         @keyframes spin {
             0% { transform: rotate(0deg); }
             100% { transform: rotate(360deg); }
         }

         .loading-indicator.hidden, .empty-state.hidden {
             opacity: 0;
             pointer-events: none;
         }

        /* --- Added: Enhanced Empty State --- */
         .empty-state {
             color: #aaa;
             font-size: 1em;
             text-align: center;
             padding: 20px;
             font-family: 'Lexend', sans-serif; /* Apply Lexend font */
         }
        .empty-state p {
             margin-bottom: 10px;
        }
        .empty-state i {
            font-size: 2em;
            margin-bottom: 10px;
        }

        /* --- Observer Target for Tracker Section --- */
         #tracker-observer-target {
             width: 100%;
             height: 1px;
             pointer-events: none;
             z-index: -1;
             margin-top: -1px;
         }

         /* Ensure Lexend is applied to headings */
         h1, h2, h3, h4, h5, h6 {
             font-family: 'Lexend', sans-serif;
         }


    </style>
</head>
<body class="bg-black text-white">

    <section id="landing" class="min-h-screen flex flex-col justify-center items-center text-center px-5">
        <h1 class="text-4xl md:text-6xl font-bold mb-4">MCU ChronoLog</h1>

        <h2 class="text-3xl md:text-5xl font-bold mb-4">
            Never Lose Your Place in the <span class="multiverse-text">Multiverse</span>.
        </h2>
        <p class="text-lg md:text-xl max-w-2xl mb-12">
            Track all MCU titles — movies, series, and specials — with an easy checklist and release tracker. Search, filter, and sort your way through the timeline!
        </p>
        <button id="startTrackingBtn">
            <span>Start Tracking</span>
            <span class="arrow">↓</span>
        </button>
         <div id="landing-observer-target" style="position: absolute; bottom: 0; left: 0; width: 100%; height: 1px; pointer-events: none; z-index: -1;"></div>
    </section>

    <section id="tracker" class="tracker-section visible">
        <h2>MCU Tracker</h2>
        <div class="main-content">
            <div class="controls flex flex-col sm:flex-row sm:flex-wrap sm:items-center gap-4 p-4 bg-[#121212] rounded-lg">
                <div class="search-bar w-full sm:w-auto">
                    <input type="search" id="search" placeholder="Search titles...">
                </div>
                <div class="filter-buttons">
                    <button data-filter="all" class="active">All</button>
                    <button data-filter="movie">Movies</button>
                    <button data-filter="series">Series</button>
                    <button data-filter="special">Specials</button>
                </div>
                <div class="sort-select mt-2 sm:mt-0 sm:ml-auto">
                    <label for="sort">Sort by:</label>
                    <select id="sort">
                        <option value="release-asc">Release Date (Asc)</option>
                        <option value="release-desc">Release Date (Desc)</option>
                        <option value="name-asc">Name (A-Z)</option>
                        <option value="name-desc">Name (Z-A)</option>
                    </select>
                </div>
            </div>

            <div class="progress-container-group">
                 <div id="overallProgressArea" class="progress-area" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="0" aria-label="Overall progress">
                     <span class="progress-label">All:</span>
                     <div class="progress-container">
                         <div id="progress" class="progress"></div>
                     </div>
                     <span id="progressCount" class="progress-count">Watched: 0 / 0</span>
                 </div>
                 <div id="filteredProgressArea" class="progress-area hidden" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="0" aria-label="Filtered progress">
                     <span id="filteredProgressLabel" class="progress-label"></span>
                     <div class="progress-container">
                         <div id="filteredProgress" class="progress"></div>
                     </div>
                     <span id="filteredProgressCount" class="progress-count">Watched: 0 / 0</span>
                 </div>
             </div>


        </div>

        <div class="movie-list-container">
            <div id="movieList" class="movie-list">
                </div>
            <div id="loadingIndicator" class="loading-indicator hidden">
                 <div class="spinner"></div>
                 <span>Loading...</span>
             </div>
             <div id="emptyState" class="empty-state hidden">
                 <p>No titles match your search or filter.</p>
                 <p class="text-sm text-gray-600">Try adjusting your criteria.</p>
             </div>
        </div>
         <div id="tracker-observer-target"></div>
    </section>

    <section id="about">
         <h2 class="text-3xl font-semibold mb-1">About</h2>
         <div class="text-3xl font-semibold mb-4 relative inline-block">
             MCU
             <div class="relative inline-block"> <span class="relative z-10">ChronoLog</span>
                 <div class="worm-line">
                     <div class="worm-container">
                         <svg class="worm-path wiggle" viewBox="0 0 200 12" preserveAspectRatio="none"><path fill="none" stroke="red" stroke-width="2.5" d="M0,6 Q10,0 20,6 T40,6 T60,6 T80,6 T100,6 T120,6 T140,6 T160,6 T180,6 T200,6" /></svg>
                         <svg class="worm-path wiggle" viewBox="0 0 200 12" preserveAspectRatio="none"><path fill="none" stroke="red" stroke-width="2.5" d="M0,6 Q10,0 20,6 T40,6 T60,6 T80,6 T100,6 T120,6 T140,6 T160,6 T180,6 T200,6" /></svg>
                     </div>
                 </div>
             </div>
         </div>
         <p class="max-w-2xl mx-auto text-lg">
             Easily track watched MCU titles, view release dates, search, filter by type, and stay updated. Your progress is saved in your browser.
             <br><br>
             Your ultimate Marvel Cinematic Universe watchlist awaits.
         </p>
     </section>


    <script>
        // --- MCU Data ---
        // Includes movies, series, and specials with release dates and types.
        // Watched status is initialized to false and loaded from localStorage.
        // Dates are approximate for future/TBA entries and should be updated periodically.
        const mcuTitles = [
            // Phase 1
            { name: "Iron Man", date: "May 2, 2008", type: "movie", watched: false },
            { name: "The Incredible Hulk", date: "June 13, 2008", type: "movie", watched: false },
            { name: "Iron Man 2", date: "May 7, 2010", type: "movie", watched: false },
            { name: "Thor", date: "May 6, 2011", type: "movie", watched: false },
            { name: "Captain America: The First Avenger", date: "July 22, 2011", type: "movie", watched: false },
            { name: "The Avengers", date: "May 4, 2012", type: "movie", watched: false },
            // Phase 2
            { name: "Iron Man 3", date: "May 3, 2013", type: "movie", watched: false },
            { name: "Thor: The Dark World", date: "November 8, 2013", type: "movie", watched: false },
            { name: "Captain America: The Winter Soldier", date: "April 4, 2014", type: "movie", watched: false },
            { name: "Guardians of the Galaxy", date: "August 1, 2014", type: "movie", watched: false },
            { name: "Avengers: Age of Ultron", date: "May 1, 2015", type: "movie", watched: false },
            { name: "Ant-Man", date: "July 17, 2015", type: "movie", watched: false },
            // Phase 3
            { name: "Captain America: Civil War", date: "May 6, 2016", type: "movie", watched: false },
            { name: "Doctor Strange", date: "November 4, 2016", type: "movie", watched: false },
            { name: "Guardians of the Galaxy Vol. 2", date: "May 5, 2017", type: "movie", watched: false },
            { name: "Spider-Man: Homecoming", date: "July 7, 2017", type: "movie", watched: false },
            { name: "Thor: Ragnarok", date: "November 3, 2017", type: "movie", watched: false },
            { name: "Black Panther", date: "February 16, 2018", type: "movie", watched: false },
            { name: "Avengers: Infinity War", date: "April 27, 2018", type: "movie", watched: false },
            { name: "Ant-Man and the Wasp", date: "July 6, 2018", type: "movie", watched: false },
            { name: "Captain Marvel", date: "March 8, 2019", type: "movie", watched: false },
            { name: "Avengers: Endgame", date: "April 26, 2019", type: "movie", watched: false },
            { name: "Spider-Man: Far From Home", date: "July 2, 2019", type: "movie", watched: false },
            // Phase 4
            { name: "WandaVision (Season 1)", date: "January 15, 2021", type: "series", watched: false },
            { name: "The Falcon and the Winter Soldier (Season 1)", date: "March 19, 2021", type: "series", watched: false },
            { name: "Loki (Season 1)", date: "June 9, 2021", type: "series", watched: false },
            { name: "Black Widow", date: "July 9, 2021", type: "movie", watched: false },
            { name: "Shang-Chi and the Legend of the Ten Rings", date: "September 3, 2021", type: "movie", watched: false },
            { name: "Eternals", date: "November 5, 2021", type: "movie", watched: false },
            { name: "Hawkeye (Season 1)", date: "November 24, 2021", type: "series", watched: false },
            { name: "Spider-Man: No Way Home", date: "December 17, 2021", type: "movie", watched: false },
            { name: "Moon Knight (Season 1)", date: "March 30, 2022", type: "series", watched: false },
            { name: "Doctor Strange in the Multiverse of Madness", date: "May 6, 2022", type: "movie", watched: false },
            { name: "Ms. Marvel (Season 1)", date: "June 8, 2022", type: "series", watched: false },
            { name: "Thor: Love and Thunder", date: "July 8, 2022", type: "movie", watched: false },
            { name: "She-Hulk: Attorney at Law (Season 1)", date: "August 18, 2022", type: "series", watched: false },
            { name: "Werewolf by Night", date: "October 7, 2022", type: "special", watched: false },
            { name: "Black Panther: Wakanda Forever", date: "November 11, 2022", type: "movie", watched: false },
            { name: "The Guardians of the Galaxy Holiday Special", date: "November 25, 2022", type: "special", watched: false },
            // Phase 5
            { name: "Ant-Man and the Wasp: Quantumania", date: "February 17, 2023", type: "movie", watched: false },
            { name: "Guardians of the Galaxy Vol. 3", date: "May 5, 2023", type: "movie", watched: false },
            { name: "Secret Invasion (Season 1)", date: "June 21, 2023", type: "series", watched: false },
            { name: "Loki (Season 2)", date: "October 5, 2023", type: "series", watched: false },
            { name: "The Marvels", date: "November 10, 2023", type: "movie", watched: false },
            { name: "Echo (Season 1)", date: "January 9, 2024", type: "series", watched: false },
             // Phase 5/6 Upcoming & Tentative (Dates as of April 2025 knowledge)
            { name: "Deadpool & Wolverine", date: "July 26, 2024", type: "movie", watched: false }, // Past release, but keep for chronology
            { name: "Agatha All Along", date: "September 18, 2024", type: "series", watched: false }, // Past release
            { name: "Your Friendly Neighborhood Spider-Man (Season 1)", date: "Late 2024/Early 2025", type: "series", watched: false }, // Animation, updated timeframe
            { name: "Eyes of Wakanda", date: "2025", type: "series", watched: false }, // Animation, updated timeframe
            { name: "Captain America: Brave New World", date: "February 14, 2025", type: "movie", watched: false }, // Past release
            { name: "Daredevil: Born Again (Season 1)", date: "March 2025", type: "series", watched: false }, // Past release
            { name: "Thunderbolts*", date: "May 2, 2025", type: "movie", watched: false }, // Asterisk notes title change
            { name: "The Fantastic Four", date: "July 25, 2025", type: "movie", watched: false },
            { name: "Blade", date: "November 7, 2025", type: "movie", watched: false },
            { name: "Ironheart (Season 1)", date: "Late 2025", type: "series", watched: false }, // Tentative timeframe
            { name: "Wonder Man (Season 1)", date: "TBA", type: "series", watched: false },
            { name: "Marvel Zombies", date: "TBA", type: "series", watched: false }, // Animation
            { name: "Spider-Man: Sophomore Year", date: "TBA", type: "series", watched: false }, // Animation
             // Phase 6
            { name: "Avengers 5", date: "May 1, 2026", type: "movie", watched: false }, // Title likely changing
            { name: "Avengers: Secret Wars", date: "May 7, 2027", type: "movie", watched: false },
             // Future / Other Potential Projects
            { name: "Armor Wars", date: "TBA", type: "movie", watched: false }, // Was series, now movie
            { name: "Shang-Chi 2", date: "TBA", type: "movie", watched: false },
            { name: "Nova", date: "TBA", type: "special", watched: false }, // Format (special/series) TBD
            { name: "Vision Quest", date: "TBA", type: "series", watched: false }
        ];

        // --- Global State Variables ---
        let currentFilter = 'all'; // Active filter ('all', 'movie', 'series', 'special')
        let currentSearchTerm = ''; // Current search input value
        const localStorageKey = 'mcuWatchedTitles'; // Key for saving watched status
        let isTrackerVisible = true; // Flag to track if the tracker section has been made visible - SET TO TRUE
        let isAboutVisible = false; // Flag to track if the about section has been made visible
        let searchTimeout; // Variable to hold the debounce timeout

        // --- Utility Functions ---

        /**
         * Capitalizes the first letter of a string.
         * @param {string} word - The string to capitalize.
         * @returns {string} The capitalized string.
         */
        function capitalize(word) {
            if (!word) return '';
            return word.charAt(0).toUpperCase() + word.slice(1);
        }

        /**
         * Parses various date string formats into Date objects for sorting.
         * Handles 'TBA', 'Month Year', 'Late/Early Year', 'YYYY', and standard 'Month Day, Year'.
         * Assigns future/invalid dates far in the future for sorting purposes.
         * @param {string} dateStr - The date string to parse.
         * @returns {Date} A Date object representing the parsed date.
         */
        function parseDate(dateStr) {
            // Handle TBA or empty strings
            if (!dateStr || dateStr.toLowerCase() === 'tba') {
                return new Date('9999-12-31'); // Far future date for TBA
            }
            // Try standard parsing first
            let date = new Date(dateStr);
            if (!isNaN(date.getTime())) {
                return date;
            }
            // Handle "LateYYYY" or "EarlyYYYY"
            let match = dateStr.match(/(Late|Early)\s*(\d{4})/i);
            if (match) {
                const year = parseInt(match[2]);
                const month = match[1].toLowerCase() === 'late' ? 11 : 0; // Dec for Late, Jan for Early
                return new Date(year, month, match[1].toLowerCase() === 'late' ? 31 : 1);
            }
            // Handle "MonthYYYY" (e.g., "March 2025")
             match = dateStr.match(/([a-zA-Z]+)\s*(\d{4})/i);
             if(match) {
                 try {
                     // Attempt to create a date like "March 1, 2025"
                     date = new Date(`${match[1]} 1, ${match[2]}`);
                     if (!isNaN(date.getTime())) return date;
                 } catch(e){ /* Ignore parsing errors here */ }
             }
            // Handle "YYYY" only
            match = dateStr.match(/^(\d{4})$/);
            if(match) {
                return new Date(parseInt(match[1]), 0, 1); // January 1st of that year
            }
            // Fallback for unparseable dates (assign slightly less future date than TBA)
            return new Date('9998-12-31');
        }

        /**
         * Escapes special characters in a string for use in a regular expression.
         * @param {string} string - The string to escape.
         * @returns {string} The escaped string.
         */
        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); // $& means the whole matched string
        }

        // --- Local Storage Functions ---

        /**
         * Loads the watched status of titles from localStorage.
         * Updates the `watched` property in the `mcuTitles` array.
         */
        function loadWatchedStatus() {
            try {
                const watchedJson = localStorage.getItem(localStorageKey);
                if (watchedJson) {
                    const watchedNames = JSON.parse(watchedJson);
                    const watchedSet = new Set(watchedNames); // Use Set for efficient lookup
                    mcuTitles.forEach(title => {
                        title.watched = watchedSet.has(title.name);
                    });
                }
            } catch (e) {
                console.error("Failed to load watched status from localStorage:", e);
            }
        }

        /**
         * Saves the names of watched titles to localStorage.
         */
        function saveWatchedStatus() {
            try {
                const watchedNames = mcuTitles
                    .filter(t => t.watched) // Get only watched titles
                    .map(t => t.name); // Get their names
                localStorage.setItem(localStorageKey, JSON.stringify(watchedNames));
            } catch (e) {
                console.error("Failed to save watched status to localStorage:", e);
                // Optionally inform the user if storage fails (e.g., private browsing mode)
            }
        }

        // --- View Control ---

        /**
         * Scrolls the tracker section into view.
         * Note: The tracker is now visible by default, so this function only handles scrolling.
         */
        function showTrackerAndScroll() {
            const trackerSection = document.getElementById('tracker');
            if (!trackerSection) {
                console.error("Tracker section element not found");
                return;
            }
            // Scroll into view
            trackerSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

         /**
          * Makes the about section visible and smoothly scrolls it into view.
          */
         function showAboutAndScroll() {
             const aboutSection = document.getElementById('about');
             if (!aboutSection) {
                 console.error("About section element not found");
                 return;
             }

             // Only make visible ONCE
             if (!isAboutVisible) {
                 aboutSection.style.display = 'block'; // Change display *before* adding visible class
                 // Use a small timeout to allow display change to take effect before adding transition class
                 setTimeout(() => {
                     aboutSection.classList.add('visible'); // Add for fade-in transition
                     isAboutVisible = true; // Set flag
                 }, 10); // Very small delay
             }

             // Scroll into view
             setTimeout(() => {
                 aboutSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
             }, 100); // Small delay helps ensure smooth scroll
         }


        // --- Rendering & Event Handling ---

        /**
         * Renders the list of MCU titles based on current filters, search term, and sort order.
         * Handles empty states and highlights search terms.
         * Uses DocumentFragment for improved rendering performance.
         * This function is called initially when the tracker becomes visible and on filter/sort/search changes.
         */
        function renderMovies() {
            // Don't render if tracker isn't shown yet (This check is less critical now that it's visible by default)
             if (!isTrackerVisible) return; // Keep this check just in case visibility logic changes later

            const list = document.getElementById('movieList');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const emptyState = document.getElementById('emptyState');

             if (!list || !loadingIndicator || !emptyState) {
                 console.error("Rendering failed: Missing essential list elements (movieList, loadingIndicator, or emptyState).");
                 return; // Exit if essential elements don't exist
             }

            // Show loading indicator
            loadingIndicator.classList.remove('hidden');
            emptyState.classList.add('hidden'); // Hide empty state

            // Use a timeout to allow the loading indicator to show before heavy rendering
            setTimeout(() => {
                const sortVal = document.getElementById('sort').value;
                const searchTerm = currentSearchTerm.trim().toLowerCase();
                // Create regex for highlighting only if there's a search term
                const searchRegex = searchTerm ? new RegExp(escapeRegExp(searchTerm), 'gi') : null; // 'g' for global match, 'i' for case-insensitive

                // 1. Filter by Type (based on currentFilter)
                let typeFiltered = mcuTitles.filter(m => currentFilter === 'all' || m.type === currentFilter);

                // 2. Filter by Search Term
                let searchFiltered = searchTerm
                     ? typeFiltered.filter(m => m.name.toLowerCase().includes(searchTerm))
                     : typeFiltered;

                // 3. Sort Results
                let sorted = [...searchFiltered]; // Create a new array to sort
                if (sortVal === 'release-asc') {
                    sorted.sort((a, b) => parseDate(a.date) - parseDate(b.date));
                } else if (sortVal === 'release-desc') {
                    sorted.sort((a, b) => parseDate(b.date) - parseDate(a.date));
                } else if (sortVal === 'name-asc') {
                    sorted.sort((a, b) => a.name.localeCompare(b.name));
                } else if (sortVal === 'name-desc') {
                    sorted.sort((a, b) => b.name.localeCompare(a.name));
                }

                // Use DocumentFragment to build the new list off-screen
                const fragment = document.createDocumentFragment();

                // 4. Create and append elements to the fragment
                if (sorted.length === 0) {
                     // Show empty state message instead of rendering items
                     emptyState.classList.remove('hidden');
                 } else {
                    emptyState.classList.add('hidden'); // Ensure empty state is hidden

                    sorted.forEach(title => {
                        const item = document.createElement('div');
                        item.className = 'movie-item'; // Apply item styles

                        // Info container (title, date, type)
                        const infoDiv = document.createElement('div');
                        infoDiv.className = 'movie-item-info';

                        const titleH3 = document.createElement('h3');
                        // Highlight search term in title if applicable
                        if (searchRegex) {
                            // Replace matches with highlighted span
                            titleH3.innerHTML = title.name.replace(searchRegex, '<span class="highlight">$&</span>');
                        } else {
                            titleH3.textContent = title.name;
                        }
                        infoDiv.appendChild(titleH3);

                        const dateP = document.createElement('p');
                        dateP.textContent = title.date; // Display date
                        infoDiv.appendChild(dateP);

                        const typeP = document.createElement('p');
                        typeP.textContent = `Type: ${capitalize(title.type)}`; // Display capitalized type
                        typeP.className = 'type'; // Apply type styles
                        infoDiv.appendChild(typeP);

                        // Checkbox container
                        const checkboxDiv = document.createElement('div');
                        checkboxDiv.className = 'checkbox'; // Apply checkbox container styles

                        const checkboxInput = document.createElement('input');
                        checkboxInput.type = 'checkbox';
                        checkboxInput.checked = title.watched; // Set checked state based on data
                        checkboxInput.setAttribute('aria-label', `Mark ${title.name} as watched`); // Accessibility label
                        // Add event listener to toggle watched status on change
                        checkboxInput.onchange = () => toggleWatch(title.name);

                        checkboxDiv.appendChild(checkboxInput); // Add checkbox to its div
                        item.appendChild(infoDiv); // Add info div to item
                        item.appendChild(checkboxDiv); // Add checkbox div to item
                        fragment.appendChild(item); // Append the complete item to the fragment
                    });
                 }

                // Clear previous items and append the new fragment to the list
                list.innerHTML = ''; // Clear existing items
                list.appendChild(fragment); // Add all new items at once

                // Hide loading indicator
                loadingIndicator.classList.add('hidden');

                // Update progress bars after rendering the list
                updateProgress();

            }, 50); // Small delay to allow loading indicator to show
        }

        /**
         * Handles clicks on filter buttons.
         * Updates the current filter, styles the active button, and re-renders the list.
         * @param {string} type - The filter type ('all', 'movie', 'series', 'special').
         */
        function filterType(type) {
             currentFilter = type; // Update global filter state
             // Update button styles
             document.querySelectorAll('.filter-buttons button').forEach(btn => btn.classList.remove('active'));
             const activeButton = document.querySelector(`.filter-buttons button[data-filter="${type}"]`);
             if (activeButton) activeButton.classList.add('active');

             // Re-render the list and update progress for the new filter
             // if (isTrackerVisible) { // This check is less critical now
                 renderMovies();
             // }
             // Always update progress, even if tracker isn't visible yet (redundant now)
             updateProgress();
           }

        /**
         * Handles input changes in the search bar using debouncing.
         * Clears the previous timeout and sets a new one to call renderMovies after a delay.
         */
        function handleSearch() {
             const searchInput = document.getElementById('search');
             currentSearchTerm = searchInput.value; // Update global search term state

             // Clear previous timeout
             clearTimeout(searchTimeout);

             // Set a new timeout to call renderMovies after 300ms
             searchTimeout = setTimeout(() => {
                 // if (isTrackerVisible) { // This check is less critical now
                     renderMovies();
                 // }
             }, 300); // 300ms debounce delay
           }

        /**
         * Handles changes in the sort dropdown.
         * Re-renders the list based on the new sort order.
         */
        function sortItems() {
             // Re-render the list
             renderMovies();
           }

        /**
         * Toggles the watched status of a specific title.
         * Updates the data array, saves the status to localStorage, and updates the progress bar.
         * @param {string} titleName - The name of the title to toggle.
         */
        function toggleWatch(titleName) {
            const title = mcuTitles.find(t => t.name === titleName);
            if (title) {
                title.watched = !title.watched; // Toggle the watched property
                updateProgress(); // Update the visual progress bars/counts
                saveWatchedStatus(); // Save the new state to localStorage
            } else {
                console.error("Could not find title to toggle:", titleName);
            }
        }

        /**
         * Updates the progress bar widths and the count texts.
         * Updates both overall and filtered progress displays.
         */
        function updateProgress() {
            const totalCount = mcuTitles.length;
            const watchedCount = mcuTitles.filter(t => t.watched).length;

            // Update Overall Progress
            const overallProgressElement = document.getElementById('progress');
            const overallProgressCountElement = document.getElementById('progressCount');
            const overallProgressArea = document.getElementById('overallProgressArea');

            const overallPercent = totalCount > 0 ? (watchedCount / totalCount) * 100 : 0;

            if (overallProgressElement) overallProgressElement.style.width = overallPercent + '%';
            if (overallProgressCountElement) overallProgressCountElement.textContent = `Watched: ${watchedCount} / ${totalCount}`;
            if (overallProgressArea) {
                 overallProgressArea.setAttribute('aria-valuenow', watchedCount);
                 overallProgressArea.setAttribute('aria-valuemin', 0);
                 overallProgressArea.setAttribute('aria-valuemax', totalCount);
            }


            // Update Filtered Progress
            const filteredProgressArea = document.getElementById('filteredProgressArea');
            const filteredProgressLabel = document.getElementById('filteredProgressLabel');
            const filteredProgressElement = document.getElementById('filteredProgress');
            const filteredProgressCountElement = document.getElementById('filteredProgressCount');

            if (currentFilter === 'all') {
                // Hide filtered progress bar when 'All' is selected
                if(filteredProgressArea) filteredProgressArea.classList.add('hidden');
            } else {
                 // Show and update filtered progress bar
                 if(filteredProgressArea) filteredProgressArea.classList.remove('hidden');

                 const filteredTitles = mcuTitles.filter(t => t.type === currentFilter);
                 const watchedFilteredCount = filteredTitles.filter(t => t.watched).length;
                 const totalFilteredCount = filteredTitles.length;

                 const filteredPercent = totalFilteredCount > 0 ? (watchedFilteredCount / totalFilteredCount) * 100 : 0;

                 if(filteredProgressLabel) filteredProgressLabel.textContent = `${capitalize(currentFilter)}:`;
                 if(filteredProgressElement) filteredProgressElement.style.width = filteredPercent + '%';
                 if(filteredProgressCountElement) filteredProgressCountElement.textContent = `Watched: ${watchedFilteredCount} / ${totalFilteredCount}`;
                 if (filteredProgressArea) {
                     filteredProgressArea.setAttribute('aria-label', `${capitalize(currentFilter)} progress: ${watchedFilteredCount} out of ${totalFilteredCount} titles watched.`);
                     filteredProgressArea.setAttribute('aria-valuenow', watchedFilteredCount);
                     overallProgressArea.setAttribute('aria-valuemin', 0);
                     overallProgressArea.setAttribute('aria-valuemax', totalFilteredCount);
                 }
            }
        }

        // --- INITIALIZATION ---
        // Runs after the DOM is fully loaded and parsed.
        document.addEventListener('DOMContentLoaded', () => {
            // 1. Load saved watched status from localStorage
            loadWatchedStatus();
            // 2. Update progress bars/counts based on loaded data (initial state)
            updateProgress();
            // 3. Render the movie list immediately since the tracker is visible
            renderMovies();


            // 4. Get references to key elements
            const startButton = document.getElementById('startTrackingBtn');
            const trackerSection = document.getElementById('tracker');
            const aboutSection = document.getElementById('about'); // Get about section
            const landingObserverTarget = document.getElementById('landing-observer-target'); // For scroll trigger to tracker
            const trackerObserverTarget = document.getElementById('tracker-observer-target'); // For scroll trigger to about
            const searchInput = document.getElementById('search'); // Get search input for event listener
            const sortSelect = document.getElementById('sort'); // Get sort select for event listener
             const filterButtons = document.querySelectorAll('.filter-buttons button'); // Get filter buttons


             // Basic check to ensure essential elements are present
             if (!startButton || !trackerSection || !aboutSection || !landingObserverTarget || !trackerObserverTarget || !searchInput || !sortSelect || filterButtons.length === 0) {
                 console.error("Initialization failed: Missing essential elements.");
                 // Optionally disable functionality or show an error message to the user
                 return;
             }

            // 5. Add click listener to the "Start Tracking" button
            // This button now ONLY scrolls to the tracker section
            startButton.addEventListener('click', () => {
                 // Since the tracker is always visible, just scroll
                 showTrackerAndScroll();
            });

            // 6. Add event listener for search input (using the debounced handler)
            searchInput.addEventListener('input', handleSearch);

            // 7. Add event listener for sort select
            sortSelect.addEventListener('change', sortItems);

            // 8. Add event listeners for filter buttons (using data attribute)
             filterButtons.forEach(button => {
                 const type = button.getAttribute('data-filter');
                 button.addEventListener('click', () => filterType(type));
             });


            // 9. Set up Intersection Observer to trigger about visibility on scroll
             const trackerObserverOptions = {
                 root: null, // Observe intersections relative to the viewport
                 rootMargin: '0px',
                 threshold: 0.1 // Trigger when 10% of the target is visible (adjust as needed)
             };

             const trackerObserverCallback = (entries, observer) => {
                 entries.forEach(entry => {
                     // If the target element is no longer intersecting the viewport (scrolled past)
                     // And the about section hasn't been made visible yet
                     if (!entry.isIntersecting && !isAboutVisible) {
                          // Make the about section visible (scrolling is handled by the user's continued scroll)
                          aboutSection.style.display = 'block';
                          setTimeout(() => {
                              aboutSection.classList.add('visible');
                              isAboutVisible = true;
                          }, 10); // Small delay

                          // Stop observing the tracker target once about is shown
                          observer.unobserve(trackerObserverTarget);
                     }
                 });
             };

             const trackerObserver = new IntersectionObserver(trackerObserverCallback, trackerObserverOptions);
             // Start observing the invisible target element at the bottom of the tracker section
             trackerObserver.observe(trackerObserverTarget);


            // 10. Set initial active filter button ('All')
            // This sets the initial filter and styles the button.
             filterType('all');

             // 11. Initially hide the about section using display: none (tracker is now visible by default)
             aboutSection.style.display = 'none';

             // Removed the landingObserver setup as it's no longer needed to show the tracker
             // Removed the initial trackerSection.style.display = 'none';

        });

    </script>
</body>
</html>
